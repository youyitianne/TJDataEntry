(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-58a1"],{"3Gho":function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"f",function(){return o}),n.d(e,"d",function(){return s}),n.d(e,"c",function(){return l}),n.d(e,"a",function(){return r}),n.d(e,"e",function(){return d});var a=n("t3Un");function i(){return Object(a.a)({url:"/names",method:"get"})}function o(t){return Object(a.a)({url:"/file",method:"post",data:t,responseType:"blob"})}function s(t){return Object(a.a)({url:"/api/getresourcelist",method:"post",params:t})}function l(){return Object(a.a)({url:"/projectList",method:"get"})}function r(t){return Object(a.a)({url:"/daily",method:"post",responseType:"blob",data:t})}function d(t){return Object(a.a)({url:"/arpufile_preview/"+t.start+"_"+t.end,method:"post",params:t,data:t})}},"41Be":function(t,e,n){"use strict";n.d(e,"a",function(){return i});var a=n("Q2AE");function i(t){if(t&&t instanceof Array&&t.length>0){var e=t;return!!(a.a.getters&&a.a.getters.roles).some(function(t){return e.includes(t)})}return!1}},BvFL:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var a=n("t3Un");function i(t){return Object(a.a)({url:"/api/getresourcelist",method:"post",params:t})}},HAgL:function(t,e,n){"use strict";var a=n("yjTf");n.n(a).a},K15r:function(t,e,n){"use strict";n.r(e);var a=n("3Gho"),i=n("41Be"),o=n("BvFL"),s=n("Q2AE"),l=n("t3Un");function r(t){return Object(l.a)({url:"/umengretention",method:"post",data:t})}var d=n("ZySA"),u=(n("7Qib"),n("nQns")),c={directives:{waves:d.a},filters:{statusFilter:function(t){return{published:"success",draft:"gray",deleted:"danger"}[t]}},data:function(){return{ltList:[],activeName1:"first",timeFlag:!0,ltvList:[],timevalueLtv:[],activeName:"second",arpuList:[],daily_download_value:[],app_name_list:[],channel_value:"",channelList:[],average:{one:0,three:0,seven:0,fourteen:0,thirty:0,lt:"0"},fullscreenLoading:!1,options:"",select_value:"",pickerOptions0:{disabledDate:function(t){return t.getTime()>Date.now()-864e4-1728e5}},directives:{waves:d.a},downloadLoading:!1,layout:"",timevalue:[],searchName:"获取ltv",tableKey:0,list:[],total:0,listLoading:!1,listQuery:{importance:void 0,title:void 0,type:void 0},listParam:{start:"",end:"",name:"",appkey:"",channel:""},importanceOptions:[1,2,3],names:[],sortOptions:[{label:"ID Ascending",key:"+id"},{label:"ID Descending",key:"-id"}],statusOptions:["published","draft","deleted"]}},mounted:function(){this.initapps(),this.fetchProject()},methods:{ltvdownLoad:function(){var t=this;if(this.downloadLoading=!0,null===this.ltvList||this.ltvList.length<1)return this.$message({message:"没有信息可以打印~",type:"warning"}),void(this.downloadLoading=!1);for(var e=this.ltvList,a=this.ltvList[0],i=[],o=1;o<e.length;o++){for(var s={},l=0;l<e[o].length;l++){s[a[l]]=e[o][l]}i.push(s)}console.log(i),Promise.all([n.e("chunk-0d49"),n.e("chunk-9283")]).then(n.bind(null,"S/jZ")).then(function(e){var n=a,o=a,s=t.formatJson(o,i);e.export_json_to_excel({header:n,data:s,filename:"友盟留存"}),t.downloadLoading=!1})},ltdownLoad:function(){var t=this;if(this.downloadLoading=!0,null===this.ltList||this.ltList.length<1)return this.$message({message:"没有信息可以打印~",type:"warning"}),void(this.downloadLoading=!1);for(var e=this.ltList,a=this.ltList[0],i=[],o=1;o<e.length;o++){for(var s={},l=0;l<e[o].length;l++){s[a[l]]=e[o][l]}i.push(s)}console.log(i),Promise.all([n.e("chunk-0d49"),n.e("chunk-9283")]).then(n.bind(null,"S/jZ")).then(function(e){var n=a,o=a,s=t.formatJson(o,i);e.export_json_to_excel({header:n,data:s,filename:"友盟留存"}),t.downloadLoading=!1})},resetTime:function(){void 0!==this.timevalueLtv&&null!==this.timevalueLtv?(this.timeFlag=!1,this.ltList=[],this.ltvList=[],this.fetchProject()):this.$message({message:"记得选择查询范围~",type:"warning"})},test:function(){this.downloadLoading=!0,this.ltList.push(this.arpuList[0]),this.ltvList.push(this.arpuList[0]);this.formatDate(new Date(this.timevalueLtv[0]),"yyyy-MM-dd"),this.formatDate(new Date(this.timevalueLtv[1]),"yyyy-MM-dd");var t=this.arpuList,e=this.options;console.log(e);for(var n=1;n<t.length;n++){var a=t[n][0];console.log(a);for(var i=0;i<e.length;i++)if(-1!=e[i].name.indexOf(a)){console.log(e[i].name,a),e[i].appkey,!0;break}}this.downloadLoading=!1},test2:function(){this.ltvList.push(this.arpuList[0]),this.ltList.push(this.arpuList[0]);for(var t=this.formatDate(new Date(this.timevalueLtv[0]),"yyyy-MM-dd"),e=this.formatDate(new Date(this.timevalueLtv[1]),"yyyy-MM-dd"),n="",a=this.options,i=0;i<a.length;i++){n=a[i].appkey;var o=a[i].name;this.handleFilter2(t,e,o,n,"全部","")}},initdate:function(){if(this.timeFlag){var t=new Date,e=new Date;e.setTime(e.getTime()-6912e5),t.setTime(t.getTime()-1728e5),this.daily_download_value.push(e),this.daily_download_value.push(t),this.timevalueLtv.push(e),this.timevalueLtv.push(t)}else this.daily_download_value[0]=new Date(this.timevalueLtv[0].getTime()+864e5),this.daily_download_value[1]=new Date(this.timevalueLtv[1].getTime()+864e5),console.log(this.daily_download_value),this.timeFlag=!0;this.daily_download1()},fetchProject:function(){var t=this,e=this;Object(a.c)().then(function(e){t.app_name_list=e.data,t.initdate()}).catch(function(t){console.log(t),e.tabLoading=!1})},daily_download1:function(){var t=this,e=this;if(null!==this.daily_download_value)if(void 0!==this.daily_download_value[0])if(void 0!==this.daily_download_value[1]){this.downloadLoading=!0;var n={start:this.daily_download_value[0],end:this.daily_download_value[1],list:this.app_name_list};this.arpuList=[],Object(u.a)(n).then(function(n){if(n){t.original=n.data.original;for(var a=n.data.arpu,i=0;i<a[0].length;i++){for(var o=[],s=0;s<a.length;s++)o.push(a[s][i]);t.arpuList.push(o)}t.arpuList;t.downloadLoading=!1,e.tabLoading=!1}}).catch(function(t){console.error(t.toString()+""),e.downloadLoading=!1,e.tabLoading=!1,e.$notify({title:"获取失败",message:"刷新试试",type:"error",duration:2e3})})}else this.open3();else this.open3();else this.open3()},checkPermission:i.a,changeselect:function(){var t=this,e=this;(function(t){return Object(l.a)({url:"/umengchannels/"+t,method:"get"})})(this.select_value.appkey).then(function(e){t.channelList=e.data.data;t.channelList=[{id:"全部",channel:"全部"}].concat(t.channelList),t.channel_value="全部"}).catch(function(t){e.$notify({title:"初始化app列表",message:"刷新试试",type:"error",duration:2e3})})},initapps:function(){var t=this,e=this;e.fullscreenLoading=!0,Object(l.a)({url:"/umengapp",method:"get"}).then(function(n){var a=n.data.data;if(t.checkPermission(["director"])||t.checkPermission(["admin"])||t.checkPermission(["operatorleader"])||t.checkPermission(["sdksuport"]))t.options=a;else{var i=[],l={username:s.a.getters&&s.a.getters.name};Object(o.a)(l).then(function(t){for(var e=t.data,n=0;n<a.length;n++){for(var o=!1,s=0;s<e.length;s++)-1!=a[n].name.indexOf(e[s])&&(o=!0);o&&i.push(a[n])}}),t.options=i}e.fullscreenLoading=!1}).catch(function(t){e.$notify({title:"初始化app列表",message:"刷新试试",type:"error",duration:2e3}),e.fullscreenLoading=!1})},handleFilter:function(){var t=this;this.list=[];var e=this;if(this.downloadLoading=!0,""===this.timevalue||null==this.timevalue||"undefined"===this.timevalue[0]||"undefined"===this.timevalue[1]||""===this.select_value)return this.$message({message:"记得选择查询范围~",type:"warning"}),void(this.downloadLoading=!1);var n=new Date(this.timevalue[0]).getTime();if(new Date(this.timevalue[1]).getTime()-n>2592e6)return e.$notify({title:"",message:"时间范围最多选择30天",type:"warning",duration:2e3}),void(this.downloadLoading=!1);this.listParam.start=this.timevalue[0],this.listParam.end=this.timevalue[1],this.listParam.name=this.select_value.name,this.listParam.appkey=this.select_value.appkey,this.listParam.channel=this.channel_value,this.listLoading=!0,r(this.listParam).then(function(e){console.log(e.data.data);for(var n=e.data.data,a=0,i=0,o=0,s=0,l=0,r=0;r<n.length;r++){var d=n[r].install_period,u=n[r].retention_rate,c=void 0===u[0]?0:u[0],h=void 0===u[1]?0:u[1],v=void 0===u[2]?0:u[2],p=void 0===u[3]?0:u[3],f=void 0===u[4]?0:u[4],g=void 0===u[5]?0:u[5],m=void 0===u[6]?0:u[6],L=void 0===u[7]?0:u[7],w=void 0===u[8]?0:u[8],y={date:d,oneDay:c,twoDay:h,threeDay:v,fourDay:p,fiveDay:f,sixDay:g,sevenDay:m,halfmonth:L,onemonth:w,lt:((1.5*(v+m)+3*(m+L)+7.5*(L+w)+c+v+m+L+w)/c*c/100+1).toFixed(4)};a+=c,i+=v,o+=m,s+=L,l+=w,t.list.push(y)}var _=a/n.length,b=i/n.length,k=o/n.length,x=s/n.length,j=l/n.length;t.average={one:(a/n.length).toFixed(2),three:(i/n.length).toFixed(2),seven:(o/n.length).toFixed(2),fourteen:(s/n.length).toFixed(2),thirty:(l/n.length).toFixed(2),lt:((1.5*(b+k)+3*(k+x)+7.5*(x+j)+_+b+k+x+j)/_*_/100+1).toFixed(4)},t.listLoading=!1,t.downloadLoading=!1}).catch(function(t){console.error(t),e.listLoading=!1,e.downloadLoading=!1})},handleFilter1:function(t,e,n,a,i,o,s){var l=this,d=this;r({start:t,end:e,name:n,appkey:a,channel:i}).then(function(t){for(var e=t.data.data,a=[],i=0;i<e.length;i++){var r=e[i].install_period,d=e[i].retention_rate,u=void 0===d[0]?0:d[0],c=(void 0===d[1]||d[1],void 0===d[2]?0:d[2]),h=(void 0===d[3]||d[3],void 0===d[4]||d[4],void 0===d[5]||d[5],void 0===d[6]?0:d[6]),v=void 0===d[7]?0:d[7],p=void 0===d[8]?0:d[8],f=((1.5*(c+h)+3*(h+v)+7.5*(v+p)+u+c+h+v+p)/u*u/100+1).toFixed(4),g={date:r,lt:window.isNaN(f)?0:f};a.push(g)}var m=[],L=[];m.push(n),L.push(n);for(var w=0;w<a.length;w++)m.push((parseFloat(l.arpuList[o][w+1])*parseFloat(a[w].lt)).toFixed(4)),L.push(parseFloat(a[w].lt).toFixed(4));l.ltList.push(L),l.ltvList.push(m),console.log(o,s),o===s&&(l.downloadLoading=!1,l.listLoading=!1)}).catch(function(t){console.error(t),d.listLoading=!1,d.downloadLoading=!1})},handleFilter2:function(t,e,n,a,i,o){var s=this,l=this,d={start:t,end:e,name:n,appkey:a,channel:i};console.log("method start"),r(d).then(function(t){var e=t.data.data,a=[];console.log("method success");for(var i=0;i<e.length;i++){var o=e[i].install_period,l=e[i].retention_rate,r=void 0===l[0]?0:l[0],d=(void 0===l[1]||l[1],void 0===l[2]?0:l[2]),u=(void 0===l[3]||l[3],void 0===l[4]||l[4],void 0===l[5]||l[5],void 0===l[6]?0:l[6]),c=void 0===l[7]?0:l[7],h=void 0===l[8]?0:l[8],v=((1.5*(d+u)+3*(u+c)+7.5*(c+h)+r+d+u+c+h)/r*r/100+1).toFixed(4),p={date:o,lt:window.isNaN(v)?0:v};a.push(p)}console.log("valuation start");var f=[];f.push(n);for(var g=0;g<a.length;g++)f.push(parseFloat(a[g].lt).toFixed(4));s.ltList.push(f),console.log(s.ltList.length),s.listLoading=!1,s.downloadLoading=!1}).catch(function(t){console.error(t),l.listLoading=!1,l.downloadLoading=!1})},setretention:function(t,e){for(var n=0;n<e.length;n++){var a=e[n].channelName,i=e[n].list;if(t.channel===a)for(var o=0;o<i.length;o++)if(i[o].install_period===t.date)return t.total_install=i[o].retention_rate[0],t.total_install_rate=0,t}return t.total_install=0,t.total_install_rate=0,t},handleDownload:function(){var t=this;if(this.downloadLoading=!0,null===this.list)return this.$message({message:"没有信息可以打印~",type:"warning"}),void(this.downloadLoading=!1);Promise.all([n.e("chunk-0d49"),n.e("chunk-9283")]).then(n.bind(null,"S/jZ")).then(function(e){var n=t.formatJson(["date","id","channel","install","active_user","launch","duration","total_install","total_install_rate"],t.list);e.export_json_to_excel({header:["时间","应用名","渠道","新增人数","活跃人数","启动次数","单次启动时长","次日留存率","版本"],data:n,filename:"友盟3"}),t.downloadLoading=!1})},formatJson:function(t,e){return e.map(function(e){return t.map(function(t){return e[t]})})},formatDate:function(t,e){/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));var n={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds()};for(var a in n)if(new RegExp("("+a+")").test(e)){var i=n[a]+"";e=e.replace(RegExp.$1,1===RegExp.$1.length?i:this.padLeftZero(i))}return e},padLeftZero:function(t){return("00"+t).substr(t.length)}}},h=(n("HAgL"),n("KHd+")),v=Object(h.a)(c,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"filter-container",staticStyle:{margin:"15px","margin-top":"15px"}},[n("el-date-picker",{attrs:{type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":t.pickerOptions0},on:{change:t.resetTime},model:{value:t.timevalueLtv,callback:function(e){t.timevalueLtv=e},expression:"timevalueLtv"}},[t._v(">\n    ")]),t._v(" "),n("el-button",{staticClass:"filter-item",attrs:{loading:t.downloadLoading,type:"primary",icon:"el-icon-search"},on:{click:t.test}},[t._v(t._s(t.searchName)+"\n    ")])],1),t._v(" "),n("el-tabs",{on:{"tab-click":function(t){}},model:{value:t.activeName1,callback:function(e){t.activeName1=e},expression:"activeName1"}},[n("el-tab-pane",{attrs:{label:"ltv",name:"first"}},[n("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{loading:t.downloadLoading,type:"primary",icon:"el-icon-download",size:"mini"},on:{click:t.ltvdownLoad}},[t._v("\n        "+t._s("下载")+"\n      ")]),t._v(" "),n("table",{staticClass:"gridtable",staticStyle:{"margin-top":"20px"}},t._l(t.ltvList,function(e,a){return n("tr",t._l(e,function(e,a){return n("td",[n("span",[t._v(t._s(e))])])}))}))],1),t._v(" "),n("el-tab-pane",{attrs:{label:"lt",name:"second"}},[n("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{loading:t.downloadLoading,type:"primary",icon:"el-icon-download",size:"mini"},on:{click:t.ltdownLoad}},[t._v("\n        "+t._s("下载")+"\n      ")]),t._v(" "),n("table",{staticClass:"gridtable",staticStyle:{"margin-top":"20px"}},t._l(t.ltList,function(e,a){return n("tr",t._l(e,function(e,a){return n("td",[n("span",[t._v(t._s(e))])])}))}))],1)],1)],1)},[],!1,null,null,null);v.options.__file="ltv.vue";e.default=v.exports},ZySA:function(t,e,n){"use strict";var a=n("P2sY"),i=n.n(a),o=(n("jUE0"),{bind:function(t,e){t.addEventListener("click",function(n){var a=i()({},e.value),o=i()({ele:t,type:"hit",color:"rgba(0, 0, 0, 0.15)"},a),s=o.ele;if(s){s.style.position="relative",s.style.overflow="hidden";var l=s.getBoundingClientRect(),r=s.querySelector(".waves-ripple");switch(r?r.className="waves-ripple":((r=document.createElement("span")).className="waves-ripple",r.style.height=r.style.width=Math.max(l.width,l.height)+"px",s.appendChild(r)),o.type){case"center":r.style.top=l.height/2-r.offsetHeight/2+"px",r.style.left=l.width/2-r.offsetWidth/2+"px";break;default:r.style.top=(n.pageY-l.top-r.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+"px",r.style.left=(n.pageX-l.left-r.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+"px"}return r.style.backgroundColor=o.color,r.className="waves-ripple z-active",!1}},!1)}}),s=function(t){t.directive("waves",o)};window.Vue&&(window.waves=o,Vue.use(s)),o.install=s;e.a=o},jUE0:function(t,e,n){},nQns:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var a=n("t3Un");function i(t){return Object(a.a)({url:"/daily_preview",method:"post",data:t})}},yjTf:function(t,e,n){}}]);